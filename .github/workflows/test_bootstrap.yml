name: Bootstrap
"on":
  push:
    branches:
      - master

# To test on a new OS version, update the 'os_version' field.
jobs:
  bootstrap_macos:
    strategy:
      #max-parallel: 4
      fail-fast: true
      matrix:
       platform: ['macos']
       bootstrap_type: ['machine+dotfiles'] 
       user_profile: ['admin', 'dev_single'] # debug: 'machine','dotfiles'
       os_version: ['macos-13', macos-14']

    name: '${{ matrix.platform }}/${{ matrix.os_version }}'
    secrets: inherit
    uses: davidandreoletti/dotfiles/.github/workflows/bootstrap_on_macos.yaml@master
    with:
      platform: ${{ matrix.platform }}
      bootstrap_type: ${{ matrix.bootstrap_type }}
      user_profile: ${{ matrix.user_profile }}
      os_version: ${{ matrix.os_version }}

    concurrency:
      group: ${{ matrix.platform }}
      cancel-in-progress: true

  bootstrap_linux:
      strategy:
        #max-parallel: 6
        fail-fast: true
        matrix:
         platform: ['linux']
         bootstrap_type: ['machine+dotfiles'] 
         user_profile: ['admin', 'dev_single'] # debug: 'machine','dotfiles'
         os_version: ['fedora:39', 'fedora:40', 'archlinux:lastest']
  
      name: '${{ matrix.platform }}/${{ matrix.os_version }}'
      secrets: inherit
      uses: davidandreoletti/dotfiles/.github/workflows/bootstrap_on_linux.yaml@master
      with:
        platform: ${{ matrix.platform }}
        bootstrap_type: ${{ matrix.bootstrap_type }}
        user_profile: ${{ matrix.user_profile }}
        os_version: ${{ matrix.os_version }}
  
      concurrency:
        group: ${{ matrix.platform }}
        cancel-in-progress: true
